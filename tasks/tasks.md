1) ТЗ на разработку Telegram-бота “Voice → Summary” (Vercel)
1.1 Цель

Бот в Telegram принимает голосовые/аудио, возвращает пользователю:

краткое “О чём речь”

тезисы

договорённости/следующие шаги

тон/настроение

1.2 Область работ (Scope)

MVP:

Приём voice и audio

Скачивание файла из Telegram по file_id

Транскрибация через OpenAI Speech-to-Text

Саммари через OpenAI Responses API

Лимиты/антиспам на пользователя

Логи ошибок и статусов

Асинхронная обработка через QStash (или эквивалент)

Не входит (но желательно как “v2”):

сохранение истории в БД и поиск

личный кабинет/панель админа

оплатные тарифы

диаризация (кто говорил) / таймкоды

1.3 Роли и сценарии
Роль: Пользователь

S1. Голосовое → саммари

Отправляет voice (OGG/OPUS) или audio.

Получает быстрый ответ “Принял. Расшифровываю…”

Затем получает саммари.

S2. Ошибки

Если файл слишком длинный/большой → бот объясняет лимит и предлагает разбить.

Если плохое качество → бот предупреждает.

Роль: Администратор (опционально)

Просмотр логов/ошибок в Vercel

Возможность включать/выключать бота (ENV BOT_DISABLED=true)

1.4 Команды

/start — описание и пример

/help — что поддерживается + лимиты

/format — выбор формата (кнопками)

/privacy — как обрабатываются данные

1.5 Формат ответа (по умолчанию)

О чём речь: 1–2 предложения

Тезисы: 5–8 пунктов

Следующие шаги / просьбы: список (если есть)

Тон: 1 строка

(опционально) Ключевые имена/даты/цифры (если есть)

1.6 Интеграции
Telegram Bot API

Получение апдейтов через webhook

Скачивание файла: getFile(file_id) → file_path → download URL формата https://api.telegram.org/file/bot<TOKEN>/<file_path>

Отправка сообщений: sendMessage

OpenAI API

Транскрибация

Endpoint: Audio Transcriptions (Speech-to-Text).

Модель: gpt-4o-mini-transcribe (или эквивалентная актуальная)

Важное про длительность: у некоторых моделей транскрибации есть лимит по секундaм (встречается 1500 сек ~ 25 минут для отдельных моделей/режимов).

Саммари

Endpoint: Responses API.

Модель: gpt-4o-mini (или иная выбранная)

Желательно: Structured Outputs (если нужно строгое JSON-поле).

1.7 Ограничения и лимиты (MVP политика)

Длительность аудио по умолчанию: до 10 минут (конфигурируемо)

Rate limit: 10 запросов/час на пользователя

Максимальный размер входного файла: например до 20–25MB (конфигурируемо)

Если превышение → бот предлагает “разбить голосовое на части”

Примечание: в Telegram voice обычно OGG/OPUS. Конвертация может быть нужна, но лучше стремиться отправлять файл “как есть” в STT, если формат поддерживается. (Список поддерживаемых форматов зависит от провайдера/обёртки; у OpenAI/моделей он может меняться, проверяйте в доке/SDK.)

1.8 Приватность и хранение данных

Аудио и промежуточные файлы не хранить постоянно

Временное хранение — только в рамках обработки (memory/tmp), затем удалять

Логи: не писать полный текст транскрипта в прод-лог (или писать только при DEBUG)

1.9 Наблюдаемость и ошибки

Логировать события:

received_update, enqueued_job, download_ok, transcribe_ok, summarize_ok, send_ok

ошибки с кодом/причиной: telegram_download_failed, openai_transcribe_failed, openai_summarize_failed, timeout, rate_limited

1.10 Приёмочные критерии (Acceptance Criteria)

Бот отвечает “Принял…” в течение ~1–2 секунд после голосового.

На голосовом 30–120 секунд возвращает саммари в заданном формате.

На плохом аудио возвращает предупреждение + максимально возможное саммари.

Rate limit реально ограничивает “спам”.

Ошибки не “молчат”: пользователь получает понятное сообщение.

“чеклист задач”)

Создать Next.js проект

Реализовать /api/telegram-webhook

валидация secret

распознавание voice/audio

enqueue в QStash (payload: chat_id, message_id, file_id, duration, user_id)

Реализовать /api/process-job

скачать файл из Telegram (getFile + download URL)

отправить в OpenAI transcribe

отправить транскрипт в OpenAI Responses для саммари

отправить ответ пользователю sendMessage

Добавить rate limit (Redis) или простой in-memory (хуже)

Обработать ошибки и ретраи

Документация: README (как настроить env, как поставить webhook)